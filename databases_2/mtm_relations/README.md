
# Работа с базой (связи many to many, сигналы)

## Описание задания

Реализовать модель хранения тематических разделов и статей каждая из которых может быть опубликована
в нескольких разделах (связь many to many). У статьи должен быть один и только один главный раздел и
это нужно контролировать. По требованиям заказчика бизнес логика должна проверяться на бэкенде.
Нужно реализовать проверку бизнес логики с использованием сигналов.


## Реализация

* создать три модели в `news.models`  1 - `Section`(Тематический раздел), 2 - `Article`(Статья), 3 - `SectionMember`(Связь между статьей и разделом)
* связать модели `Section` и `Article` через модель `SectionMember` и параметр `through`
* после создания моделей и миграции их в БД раскомментировать код в `news.forms`
* релизовать методы в `news.signals` так чтобы были покрыты следующие случаи:
    1) Нельзя несколько раз добавить одинаковую связь между Статьей и Разделом
    2) Изменить статус основного Раздела можно только сделав другой Раздел основным
    3) При создании основного раздела для определенной Cтатьи делать прошлый основной Раздел дополнительным
    4) При создании новой Статьи автоматически ставить основным разделом Раздел с `id`=1
    5) Нельзя удалить единственный Раздел

### Описание моделей

`Article` - статья
* title - Название статьи
* text - Основная информация
* sections - Связь с `Section`
* pub_date - Дата публикации
* image - Изображение

`Section` - раздел
* name - Название раздела

`SectionMember` - модель для связи статьи и раздела
* article - Связь с `Article`
* section - Связь с `Section`
* main - Является ли раздел основным для статьи

## Дополнительная информация

Для того чтобы тестировать Добавление, Изменение, Удаление экземпляров в Админке вам нужно создать админа

```bash
python manage.py createsuperuser
```

## Документация по проекту

Для запуска проекта необходимо:

* Создать базу данных, пример для Postgres с PgAdmin:

```bash
createuser --createdb Netologer
createdb Netology -U Netologer
```

* Установить зависимости:

```bash
pip install -r requirements.txt
```

* Создать файл с локальными настройками `app/settings_local.py`
и задать туда обязательные параметры:

* SECRET_KEY - секретная строка
* DATABASES - база данных, [документация по базам данных в Django](https://docs.djangoproject.com/en/2.1/ref/databases/#connecting-to-the-database)
* MEDIA_URL - URL по которому будут обслуживаться медиа файлы
* MEDIA_ROOT - путь по которому медиа файлы будут храниться у вас на устройстве

Например:

```python
SECRET_KEY = 'd+mw&mscg5i&tx+#@bf+6m%e+d5z!u#!n%z-^o9u7y1felv2o&'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'Netology',
        'USER': 'Netologer',
        'PASSWORD': '',
        'HOST': 'localhost',
        'PORT': '5432'
    }
}

MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'news/media')
```

* Реализовать модели и сделать миграцию

* Выполнить команду:

```bash
python manage.py runserver
```